"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),host="https://newsapi.org/",apiVersion="v1/",Sources="sources/",ArticlesUrl="/articles?source=",URLS=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"HOST",get:function(){return host}},{key:"API_VERSION",get:function(){return apiVersion}},{key:"SOURCES",get:function(){return Sources}},{key:"ARTICLES",get:function(){return ArticlesUrl}}]),a}(),Observable=function(){function a(){_classCallCheck(this,a),this._observers=new Map}return _createClass(a,[{key:"addObserver",value:function(a,b){this._observers.has(a)||this._observers.set(a,[]),this._observers.get(a).push(b)}},{key:"removeObserver",value:function(a,b){var c=this._observers.get(a),d=void 0;return!!(c&&c.length&&(d=c.reduce(function(a,c,d){return isFunction(c)&&c===b?a=d:a},-1),d>-1))&&(c.splice(d,1),this._observers.set(a,c),!0)}},{key:"emit",value:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=this._observers.get(a);return!(!e||!e.length)&&(e.forEach(function(a){a.apply(void 0,c)}),!0)}}]),a}(),Article=function a(b,c,d,e,f,g){_classCallCheck(this,a),this.author=e,this.title=b,this.description=d,this.url=c,this.urlToImage=f,this.publishedAt=g},Articles=function(){function a(b,c){_classCallCheck(this,a),this.source=b,this.sortBy=c,this._articles=[]}return _createClass(a,[{key:"Add",value:function(a){this._articles.push(a)}},{key:"Articles",get:function(){return this._articles}}]),a}(),SourceItem=function a(b,c,d,e,f,g,h,i,j){_classCallCheck(this,a),this.id=b,this.name=c,this.description=d,this.url=e,this.category=f,this.language=g,this.country=h,this.urlsToLogos=new UrlsToLogos(i.small,i.medium,i.large),this.sortBysAvailable=j},UrlsToLogos=function a(b,c,d){_classCallCheck(this,a),this.small=b,this.medium=c,this.large=d},SourceService=function(){function a(){_classCallCheck(this,a),this._sources=[]}return _createClass(a,[{key:"getSources",value:function(){var a=this;return this._sources.length>0?Promise.resolve(this._sources):fetch(URLS.HOST+URLS.API_VERSION+URLS.SOURCES).then(function(a){return a.ok?a.json():void console.log(a.statusText)}).then(function(b){var c=!0,d=!1,e=void 0;try{for(var f,g=b.sources[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;a._sources.push(new SourceItem(h.id,h.name,h.description,h.url,h.category,h.language,h.contry,h.urlsToLogos,h.sortBysAvailable))}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return a._sources}).catch(function(a){console.log(a)})}}]),a}(),ArticlesService=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"getArticlesBySourceId",value:function(a){var b=new Headers;b.append("X-Api-Key","caa2a0adb8424a32bb0a582406293aa1");var c={method:"GET",headers:b,mode:"cors",cache:"default"};return fetch(URLS.HOST+URLS.API_VERSION+URLS.ARTICLES+a,c).then(function(a){return a.ok?a.json():void console.log(a.statusText)}).then(function(a){var b=new Articles(a.source,a.sortBy),c=!0,d=!1,e=void 0;try{for(var f,g=a.articles[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;b.Add(new Article(h.title,h.url,h.description,h.author,h.urlToImage,h.publishedAt))}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return b}).catch(function(a){console.log(a)})}}]),a}(),ArticlesPresenter=function(){function a(b,c,d){_classCallCheck(this,a),this._observable=d,d.addObserver("sourceChanged",this.onSourceChanged.bind(this)),this._articleService=c,this._articlesView=b,this._articlesView.Presenter=this}return _createClass(a,[{key:"onSourceChanged",value:function(a){this.loadArticles(a)}},{key:"loadArticles",value:function(a){var b=this;this._articleService.getArticlesBySourceId(a).then(function(a){b.setArticles(a.Articles)}).catch(function(a){return alert(a)})}},{key:"setArticles",value:function(a){this._articlesView.showArticles(a)}},{key:"goBack",value:function(){this._observable.emit("back")}}]),a}(),SourcePresenter=function(){function a(b,c,d){_classCallCheck(this,a),this._observable=d,d.addObserver("back",this.loadSources.bind(this)),this._sourceService=c,this._sourceView=b,this._sourceView.Presenter=this,this._selectedSourceId=null}return _createClass(a,[{key:"loadSources",value:function(){var a=this;return this._sourceService.getSources().then(function(b){b?a.setSources(b):alert("there is no source items")}).catch(function(a){return alert(a)})}},{key:"setSources",value:function(a){this._sourceView.showSources(a)}},{key:"SelectedSourceId",set:function(a){this._selectedSourceId=a,this._observable.emit("sourceChanged",this._selectedSourceId)}}]),a}(),MainPresenter=function(){function a(){_classCallCheck(this,a),this._observable=new Observable,this._sourcePresenter=new SourcePresenter(new SourcesView,new SourceService,this._observable),this._articlesPresenter=new ArticlesPresenter(new ArticlesView,new ArticlesService,this._observable)}return _createClass(a,[{key:"initialize",value:function(){this._sourcePresenter.loadSources()}}]),a}(),articleItemTemplate=function(a){return'<a href="'+a.url+'">\n        <div class ="item-container">\n            <div class ="article-image"><img class ="image-fit" src="'+a.urlToImage+'"></div>\n            <div class ="article-text-area">\n                <div class="article-item-header">'+a.title+'</div>\n                <div class ="article-item-description">'+a.description+"</div>\n            </div>\n        </div>\n     </a>"},sourceItemTemplate=function(a){return'<div class="item-container">\n        <div class ="source-image wide"><img class ="image-fit" src="'+a.urlsToLogos.medium+'"></div>\n        <div class="source-item-class">'+a.name+"</div>\n     </div>"},Templates=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"ArticleItemTemplate",get:function(){return articleItemTemplate}},{key:"SourceItemTemplate",get:function(){return sourceItemTemplate}}]),a}(),View=function(){function a(){_classCallCheck(this,a),this._presenter=null,this._viewControl=document.getElementById("view")}return _createClass(a,[{key:"clearView",value:function(){this._viewControl.innerHTML=""}},{key:"Presenter",set:function(a){this._presenter=a}}]),a}(),SourcesView=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this))}return _inherits(b,a),_createClass(b,[{key:"showSources",value:function(a){scroll(0,0),_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"clearView",this).call(this);var c=document.createElement("div");c.setAttribute("class","listPanel");var d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=document.createElement("div");j.innerHTML=Templates.SourceItemTemplate(i),j.setAttribute("data-source-id",i.id),j.setAttribute("class","column-1of3 border"),j.addEventListener("click",this.onSourceSelected.bind(this),!1),c.appendChild(j)}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}this._viewControl.appendChild(c)}},{key:"onSourceSelected",value:function(a){a.preventDefault();var b=a.currentTarget;null!=this._presenter&&(this._presenter.SelectedSourceId=b.getAttribute("data-source-id"))}}]),b}(View),ArticlesView=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this))}return _inherits(b,a),_createClass(b,[{key:"showArticles",value:function(a){scroll(0,0),_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"clearView",this).call(this);var c=document.createElement("div"),d=document.createElement("div");d.addEventListener("click",this.onBackClick.bind(this),!1),d.innerText="Back",d.setAttribute("class","back-button"),c.appendChild(d);var e=document.createElement("div");e.setAttribute("class","table");var f=0,g=document.createElement("div");g.setAttribute("class","row"),e.appendChild(g);var h=!0,i=!1,j=void 0;try{for(var k,l=a[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;f++;var n=document.createElement("div");n.setAttribute("class","border table-cell article-max-cell-width"),n.innerHTML=Templates.ArticleItemTemplate(m),g.appendChild(n),3===f&&(f=0,g=document.createElement("div"),g.setAttribute("class","row"),e.appendChild(g))}}catch(a){i=!0,j=a}finally{try{!h&&l.return&&l.return()}finally{if(i)throw j}}c.appendChild(e),this._viewControl.appendChild(c)}},{key:"onBackClick",value:function(){this._presenter.goBack()}}]),b}(View);!function(){var a=new MainPresenter;a.initialize()}();